# Teamwork 评审流程

> 本文件定义所有评审流程的详细规范。

---

## 一、PRD 评审流程

**PM 写完 PRD 后，PMO 自动启动 Subagent 执行多角色评审**（规范：agents/prd-review.md）：

**Step 1**: PM 输出 PRD
**Step 2**: RD 评审（技术角度）
**Step 3**: Designer 评审（设计角度，如需 UI）
**Step 4**: QA 评审（测试角度）
**Step 5**: PMO 评审（项目角度）
**Step 6**: 汇总问题到 PRD-REVIEW.md

### 各角色评审维度

```
📋 RD 评审（技术可行性）：
├── 技术可行性：需求是否可实现？有无技术限制？
├── 实现复杂度：预估工作量，是否需要拆分？
├── 技术风险：是否涉及新技术/第三方依赖？
├── 数据结构：数据模型是否清晰？是否需要数据库变更？
├── 接口设计：与现有系统的集成点是否明确？
└── 遗漏场景：是否有技术上必须处理但 PRD 未提及的场景？

📋 Designer 评审（设计合理性，如需 UI）：
├── 交互合理性：用户流程是否顺畅？
├── 信息架构：页面结构是否合理？
├── 设计工作量：UI 复杂度评估
├── 复用性：是否可复用现有设计组件？
├── 特殊状态：空态、加载态、错误态是否考虑？
└── 响应式需求：是否需要适配不同设备？

📋 QA 评审（测试可行性）：
├── 验收标准清晰度：是否可量化、可验证？
├── 边界条件：是否明确了边界情况？
├── 异常场景：异常处理是否定义清楚？
├── 测试可行性：是否可以自动化测试？
├── 数据依赖：测试需要什么数据准备？
└── 遗漏用例：是否有明显遗漏的测试场景？

📋 PMO 评审（项目风险）：
├── 范围风险：需求边界是否清晰？是否有蔓延风险？
├── 依赖风险：是否依赖外部资源/团队？
├── 时间风险：是否有时间敏感的约束？
├── 优先级合理性：P0/P1/P2 划分是否合适？
├── 待决策项：是否有遗留的待决策事项？
└── 与现有功能冲突：是否影响已有功能？
```

### 评审输出格式

```
📋 PRD 评审汇总（F{编号}-{功能名}）
=====================================

## RD 评审
| ID | 问题 | 类型 | 建议 |
|----|------|------|------|
| R1 | API 限流策略未定义 | 遗漏 | 建议补充每分钟请求限制 |
| R2 | 预估工作量 3 人天 | 信息 | - |

RD 结论: ✅ 可行 / ⚠️ 有风险 / ❌ 不可行

## Designer 评审（如需 UI）
| ID | 问题 | 类型 | 建议 |
|----|------|------|------|
| D1 | 空态设计未定义 | 遗漏 | 建议补充空数据时的展示 |

Designer 结论: ✅ 可行 / ⚠️ 有风险

## QA 评审
| ID | 问题 | 类型 | 建议 |
|----|------|------|------|
| Q1 | 验收标准「性能良好」不可量化 | 不清晰 | 建议改为「响应时间 < 200ms」|

QA 结论: ✅ 清晰 / ⚠️ 需补充

## PMO 评审
| ID | 问题 | 类型 | 建议 |
|----|------|------|------|
| P1 | 依赖第三方支付接口 | 依赖风险 | 需确认接口对接时间 |

PMO 结论: ✅ 可控 / ⚠️ 有风险

---

## 待用户确认
| 序号 | 来源 | 问题 | 建议方案 |
|------|------|------|----------|
| 1 | RD-R1 | API 限流策略 | 100次/分钟 |
| 2 | QA-Q1 | 性能指标量化 | < 200ms |
| 3 | PMO-P1 | 第三方接口时间 | 需用户确认 |

请确认以上问题后，PRD 才能进入「已确认」状态。
```

### 评审结果处理

```
评审完成后：
├── 有待确认问题 → ⏸️ 等待用户确认
│   ├── 用户确认「修改」→ PM 更新 PRD → 重新评审
│   ├── 用户确认「接受建议」→ PM 按建议更新
│   └── 用户确认「忽略」→ 记录到 PRD-REVIEW.md
└── 无问题 → ⏸️ 用户最终确认 PRD → 进入下一阶段
```

### 评审触发规则

```
✅ 自动触发评审：
├── PM 首次完成 PRD
├── PRD 有重大修改后
└── 用户要求重新评审

❌ 不触发评审：
├── 仅修改文案/typo
└── 用户明确说「跳过评审」
```

---

## 二、TC 评审流程

**QA 写完用例后，PMO 自动启动 Subagent 执行多角色评审**（规范：agents/tc-review.md）：

**Step 1**: QA 输出用例
**Step 2**: PM 评审（需求角度）
**Step 3**: RD 评审（技术角度）
**Step 4**: Designer 评审（UI 角度，如需 UI）🆕
**Step 5**: 汇总问题到 TC-REVIEW.md

### 各角色评审维度

```
📋 PM 评审（需求角度）：
├── 需求覆盖：是否覆盖 PRD 中所有需求项？
├── 场景完整：是否有遗漏的业务场景？
├── 验收对齐：用例是否与验收标准对齐？
├── 优先级：P0 场景是否都有用例？
└── 边界情况：边界条件是否考虑全面？

📋 RD 评审（技术角度）：
├── 技术可行性：用例是否可自动化？
├── 数据依赖：测试数据准备是否清晰？
├── 接口覆盖：API 用例是否覆盖所有端点？
├── 异常场景：技术层面的异常是否覆盖？
└── 性能场景：是否需要性能测试用例？

📋 Designer 评审（UI 角度，如需 UI）🆕：
├── 状态覆盖：加载态/空态/错误态是否有用例？
├── 交互验证：关键交互流程是否有用例？
├── 视觉验证：UI 还原检查点是否完整？
├── 响应式：不同设备的适配是否有用例？
└── 特殊状态：设计稿中的特殊状态是否覆盖？
```

### 评审输出格式

```
📋 TC 评审汇总（F{编号}-{功能名}）
=====================================

## PM 评审（需求角度）
| ID | 用例 | 问题 | 类型 | 建议 |
|----|------|------|------|------|
| PM1 | - | 缺少「用户锁定后登录」场景 | 遗漏 | 补充 TC-007 |

PM 结论: ✅ 通过 / ❌ 有问题

## RD 评审（技术角度）
| ID | 用例 | 问题 | 类型 | 建议 |
|----|------|------|------|------|
| RD1 | TC-003 | 数据库验证表缺少索引检查 | 建议 | 补充索引验证 |

RD 结论: ✅ 通过 / ❌ 有问题

## Designer 评审（UI 角度，如需 UI）🆕
| ID | 用例 | 问题 | 类型 | 建议 |
|----|------|------|------|------|
| D1 | - | 缺少按钮 loading 状态验证 | 遗漏 | 补充加载状态用例 |
| D2 | - | 空态展示未覆盖 | 遗漏 | 补充空数据场景 |

Designer 结论: ✅ 通过 / ❌ 有问题

---

## 待用户确认
| 序号 | 来源 | 问题 | 建议 |
|------|------|------|------|
| 1 | PM1 | 用户锁定场景 | 补充用例 |
| 2 | D1 | loading 状态 | 补充用例 |

请确认以上问题后，TC 才能进入「已确认」状态。
```

### 评审角色动态选择

```
TC 评审角色：
├── 需要 UI → PM + RD + Designer（3 角色）
└── 不需要 UI → PM + RD（2 角色）

判断依据：参照 SKILL.md 中 Designer「是否需要 UI」统一判断标准
```

### 评审结果处理

```
评审完成后：
├── 有待确认问题 → ⏸️ 等待用户确认
│   ├── 用户确认「修改」→ QA 修改用例 → 重新评审
│   └── 用户确认「忽略」→ 记录到 TC-REVIEW.md
└── 无问题 → PMO 摘要 → ✅ 自动进入 RD 技术方案
```

---

## 三、UI 还原验收流程

**架构师 Code Review Subagent 完成后触发（如有 UI），最多 3 轮验收循环**

### 验收检查项

```
📋 Designer UI 还原验收检查项：
├── 布局结构：是否与设计稿一致
├── 颜色/字体：是否符合设计标注
├── 间距/边距：是否符合设计标注
├── 交互效果：hover/点击/动画是否正确
├── 状态展示：加载态/空态/错误态是否完整
├── 响应式：各断点是否正确适配
└── 细节还原：图标/圆角/阴影等是否准确
```

### 验收循环流程（最多 3 轮）

```
Designer 验收（第 1 轮）
    ↓
有问题？
├── 无 → ✅ 进入 QA 代码审查
└── 有 → 问题清单交给 RD
         ↓
    RD 评估每个问题：
    ├── 可修复 → 修复代码
    └── 无法还原（技术限制）→ 标记「需用户确认」
         ↓
    RD 修复完成 → Designer 重新验收（第 2 轮）
         ↓
    还有问题？→ 继续循环（最多到第 3 轮）
         ↓
    第 3 轮仍有分歧？→ ⏸️ 强制升级给用户决定
         ↓
    无法还原的问题 → ⏸️ 用户确认
    ├── 接受当前实现
    ├── 调整设计稿 → Designer 更新 → RD 重新实现
    └── 记录为技术债务，后续处理
```

### 验收报告格式

**正常验收报告**：
```
📋 Designer UI 还原验收（第 X/3 轮）
=====================================

## 验收状态
├── 当前轮次：第 X 轮（最多 3 轮）
├── 累计问题：X 个
├── 已解决：X 个
└── 剩余：X 个

## 验收结果
| 页面 | 检查项 | 结果 | 问题 |
|------|--------|------|------|
| 登录页 | 布局结构 | ✅ | - |
| 登录页 | 颜色字体 | ✅ | - |
| 登录页 | 交互效果 | ⚠️ | 按钮 hover 颜色偏深 |

## 问题清单
| # | 页面 | 问题 | RD 处理 | 状态 |
|---|------|------|---------|------|
| 1 | 登录页 | 按钮 hover 颜色应为 #40a9ff | 可修复 | 🔄 待修复 |
| 2 | 登录页 | 渐变背景无法实现 | 无法还原 | ⏸️ 需确认 |

## 待 RD 修复
- [ ] #1 按钮 hover 颜色

## 需用户确认（RD 无法还原）
| # | 问题 | 原因 | 建议方案 |
|---|------|------|----------|
| 2 | 渐变背景 | 当前框架不支持 | 改用纯色背景 #f5f5f5 |

## 验收结论
├── ✅ 通过 → 自动进入 QA 代码审查
└── 🔄 待修复 → RD 修复后重新验收
```

**第 3 轮最终验收报告（仍有分歧时）**：
```
📋 Designer UI 还原验收（第 3/3 轮 - 最终）
=====================================

⚠️ 已达验收轮次上限，需用户决定

## 仍存在的分歧
| # | 问题 | Designer 意见 | RD 意见 | 建议 |
|---|------|---------------|---------|------|
| 1 | 按钮阴影 | 需要 2px 阴影 | 性能影响大 | 接受无阴影 |
| 2 | 渐变色 | 需要渐变背景 | 框架不支持 | 改用纯色 |

## 请用户选择处理方式
对于每个分歧项，请选择：
├── 「接受」→ 按 RD 当前实现继续
├── 「调整设计」→ Designer 修改设计稿适配技术限制
└── 「技术债务」→ 记录到 TECH.md，后续版本优化

请回复处理决定后继续。
```

### 验收循环上限规则

```
⚠️ 最多 3 轮验收循环，防止无限循环：

第 1 轮：正常验收，输出问题清单
第 2 轮：复验，检查修复情况
第 3 轮：最终验收，仍有分歧则强制升级

第 3 轮后仍有问题：
├── ⏸️ 必须暂停，升级给用户决定
├── 用户选择：
│   ├── 「接受」→ 记录差异，继续流程
│   ├── 「调整设计」→ Designer 修改设计稿
│   └── 「技术债务」→ 记录到 TECH.md，后续迭代处理
└── 禁止继续循环
```
