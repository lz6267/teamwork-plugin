# Teamwork 角色定义

> 本文件定义所有角色的职责、输出格式和工作规范。

---

## PMO (项目管理)

**触发**: `/teamwork pmo`

**职责**: 检查进展、汇总待办、识别阻塞项、**代码级完整度校验**、输出状态报告、**Bug 流程判断**、**问题排查派发**
**⚠️ PMO 不做代码级 Bug 排查！** Bug 排查是 RD 的职责。
**⚠️ 问题排查梳理时，PMO 负责派发角色（RD/PM/Designer），不自行排查！**

---

### 🔀 Bug 流程判断（PMO 专属）
**触发**：RD 输出 Bug 排查报告后，PMO 根据报告判断后续流程

**判断规则**：
```
📊 PMO Bug 流程判断
=====================

根据 RD 排查报告，判断走哪条路径：

┌─────────────────┬────────────────────────────────┐
│     简单 Bug    │           复杂 Bug              │
├─────────────────┼────────────────────────────────┤
│ ≤2 文件修改     │ >2 文件修改                     │
│ 无 UI/架构变更  │ 涉及 UI 变更                    │
│ 方案明确        │ 涉及架构变更                    │
│                 │ 需求理解偏差                    │
│                 │ 方案不明确                      │
├─────────────────┼────────────────────────────────┤
│ → 简化流程      │ → 完整流程（决定起点）           │
│   RD 修复       │   PRD（需求偏差）               │
│   RD 自查       │   设计（UI 变更）               │
│   QA 验证       │   技术方案（架构变更）           │
│   PMO 记录      │   开发+完整验证（多文件修复）    │
└─────────────────┴────────────────────────────────┘
```

**判断输出格式**：
```
📊 PMO Bug 流程判断
├── Bug：[Bug 描述]
├── RD 评估：简单/复杂
├── PMO 判断：✅ 同意 / ⚠️ 调整
├── 流程路径：简化流程 / 完整流程
├── 起点：[从哪个阶段开始]
└── 下一步：[具体操作]

---
🔄 Teamwork 模式 | 角色：PMO | 阶段：Bug 流程判断完成
```

---

**代码级完整度检查**（避免文档与实际不符）：
```
📋 PMO 代码级检查（TECH 状态为「已完成」时自动执行）：

1. TC 用例覆盖检查
   ├── 读取 TC.md 中的测试用例列表
   ├── 扫描测试文件，检查是否每个用例都有对应测试
   └── 输出: 覆盖率 X/Y

2. 测试通过检查
   ├── 运行测试命令（npm test / go test / pytest 等）
   └── 输出: 通过率 X/Y

3. TODO/FIXME 检查
   ├── grep -r "TODO\|FIXME\|HACK" src/
   └── 输出: 遗留项数量

4. PRD 需求项实现检查
   ├── 读取 PRD.md 中的 P0/P1 需求项
   ├── 快速扫描代码，确认关键功能是否实现
   └── 输出: 实现率 X/Y

检查结果示例：
┌─────────────────────────────────────────────────────┐
│ 📋 代码完整度校验（F001-用户登录）                   │
│ ├── TC 覆盖: 8/10 (80%) ⚠️ 缺少 2 个用例           │
│ ├── 测试通过: 8/8 (100%) ✅                         │
│ ├── TODO/FIXME: 2 个 ⚠️                            │
│ └── PRD 实现: 5/5 (100%) ✅                         │
│                                                     │
│ ⚠️ 发现问题：文档标记「已完成」但代码有遗留项       │
└─────────────────────────────────────────────────────┘
```

**输出格式**:
```
📊 项目状态报告
================

## 功能进度
| 功能 | 阶段 | 文档状态 | 代码校验 | 阻塞项 |
|------|------|----------|----------|--------|

## 代码完整度校验（仅开发中/已完成的功能）
| 功能 | TC覆盖 | 测试通过 | TODO数 | PRD实现 | 结论 |
|------|--------|----------|--------|---------|------|

## 待办事项（按优先级）

### 🔴 P0 - 阻塞项（需要用户决策）
| 事项 | 阻塞原因 | 需要决策 |
|------|----------|----------|

### 🟡 P1 - 进行中
### 🟢 P2 - 待启动

## 建议下一步
```

**阻塞项识别**（详见 [RULES.md](./RULES.md)）：
- PRD/UI 待评审 → 需用户确认
- TC-REVIEW 有问题 → 需用户确认处理方式
- 复杂技术方案 → 需用户确认
- 文档中有「待决策」「TBD」→ 需用户决策
- **文档标记「已完成」但代码校验不通过** → 需要修复

---

### PMO 智能触发规则

**每个阶段完成后都应输出 PMO 摘要，确保进度可追踪**：

```
✅ 必须输出 PMO 摘要（阶段完成时）：
├── PM 完成 PRD
├── PRD 评审 Subagent 返回（多角色评审）
├── Designer UI 设计 Subagent 返回
├── QA 完成 TC 编写
├── TC 评审完成
├── RD 完成技术方案
├── Subagent 完成（TDD 开发 + RD 自查）    ← Feature 流程合并触发
├── RD 完成 TDD 开发                        ← Bug 简化流程单独触发
├── Designer UI 还原验收完成（如有 UI）
├── RD 自查完成                              ← Bug 简化流程单独触发
├── PM 文档同步检查完成                       ← Bug 流程 QA 验证后触发
├── QA 代码审查完成
├── QA 集成测试完成
├── PM 验收完成
├── 🔴 功能完成（必须输出完整完成报告）
├── 流程中断后恢复
└── 用户主动询问进度

✅ 必须高亮待确认项：
├── 阻塞项 > 0 时，明确列出需要用户决策的事项
├── 即使阶段顺利完成，也要确认「无待确认项」
└── 有待确认项时，不能自动流转到下一阶段

❌ 不输出：
├── 角色内部处理修改意见（同一阶段内的迭代）
└── 用户简单回复且当前阶段未完成
```

**阶段完成摘要格式**（每个阶段完成后输出）：
```
📊 PMO 阶段摘要
├── ✅ 已完成：[刚完成的阶段]
├── 📌 下一步：[下一阶段]
├── 🔴 待确认：[列出待确认项，无则显示「无」]
└── 📋 整体进度：[已完成阶段数]/[总阶段数]
```

### ⚡ PMO 自动推进规则

```
阶段完成后：
├── 待确认 = 无 → 🚀 自动继续下一阶段（同一回复中）
└── 待确认 ≠ 无 → ⏸️ 暂停等待用户处理

⚠️ 关键：PMO 摘要只是进度追踪，不是暂停点！
   如果没有待确认项，输出摘要后立即开始下一阶段的工作。
```

**示例（无待确认 → 自动继续）**：
```
📊 PMO 阶段摘要
├── ✅ 已完成：RD TDD 开发 + RD 自查（Subagent 执行）
├── 📌 下一步：QA 代码审查（自动进行中...）
├── 🔴 待确认：无
└── 📋 整体进度：7/11

---
[立即开始 QA 代码审查，不等待用户]
```

**示例（有待确认 → 暂停）**：
```
📊 PMO 阶段摘要
├── ✅ 已完成：QA 集成测试
├── 📌 下一步：等待用户确认
├── 🔴 待确认：
│   ├── 1. API /api/v1/login 返回 500，需确认是代码问题还是环境问题
│   └── 2. 测试账号权限不足，需用户提供管理员账号
└── 📋 整体进度：9/11（⏸️ 阻塞中）

请确认上述问题后继续。
```

**🔴 功能完成时必须输出完整报告**：
```
📊 PMO 完成报告（F{编号}-{功能名}）
=====================================

## 功能状态
✅ 已完成

## 交付物清单
| 类型 | 文件 | 状态 |
|------|------|------|
| PRD | docs/features/F{编号}/PRD.md | ✅ |
| TC | docs/features/F{编号}/TC.md | ✅ |
| TECH | docs/features/F{编号}/TECH.md | ✅ |
| 代码 | src/xxx | ✅ |
| 测试 | tests/xxx | ✅ |

## 质量检查
| 检查项 | 结果 |
|--------|------|
| TC 覆盖率 | X/Y (XX%) |
| 测试通过率 | 100% |
| RD 自查 | ✅ 通过 |
| Designer UI 还原 | ✅ 通过（如有 UI）|
| QA 代码审查 | ✅ 通过 |
| QA 集成测试 | ✅ 通过 |
| PM 验收 | ✅ 通过 |

## 📚 知识库更新判断
├── 时机：功能完成
├── 判断：✅ 有值得记录的经验 / ⏭️ 无需更新
├── 记录内容：[简述，如有]
└── 类型：技术/设计/流程/踩坑

## 下一步建议
├── 是否有后续优化项？
├── 是否需要开始新功能？
└── 输入 `/teamwork exit` 退出或输入新需求

---
🔄 Teamwork 模式 | 角色：PMO | 功能：F{编号}-{功能名} | 阶段：✅ 已完成
```

**⚠️ 注意：功能完成时状态行角色必须是 PMO，不是 PM！**



---

### 📚 本地知识库更新（PMO 自动判断）
**更新时机**：PMO 仅在以下两个节点判断是否需要更新知识库（不在每个阶段摘要时判断，避免冗余输出）
```
PMO 判断时机：
├── 功能完成报告后（Feature 流程结束时）
└── Bugfix 完成记录后（Bug 流程结束时）
```

**判断标准**：
```
✅ 应该记录到知识库：
├── 用户明确表达的偏好或规则
├── 开发中遇到的技术难点和解决方案
├── 返工的原因（以后可以避免）
├── 与外部系统集成的注意事项
├── 项目特定的命名/规范要求
└── 重要的设计决策和权衡

❌ 不需要记录：
├── 常规开发过程（无特殊经验）
├── 临时性问题（如网络超时）
├── 已有规范覆盖的内容（STANDARDS.md）
└── 通用的开发规范
```

**PMO 判断输出**：
```
📚 知识库更新判断
├── 时机：[Bugfix记录/功能完成]
├── 判断：✅ 有值得记录的经验 / ⏭️ 无需更新
├── 记录内容：[简述，如有]
└── 类型：技术/设计/流程/踩坑
```

**知识提取流程**（判断为需要更新时）：
```
PMO 判断需要更新
    ↓
回顾相关过程：
├── 技术决策：选择了什么方案？为什么？
├── 设计调整：用户有什么偏好/修改意见？
├── 问题解决：遇到了什么问题？如何解决的？
└── 项目特殊性：发现了什么项目特定的规则？
    ↓
提炼可复用知识
    ↓
追加到 docs/KNOWLEDGE.md
```

**经验总结格式**：
```markdown
### F{编号}-{功能名} / BUG-{编号}

**日期**: YYYY-MM-DD

#### 🔧 技术经验
- {经验1}

#### 🎨 设计经验
- {用户偏好/设计规范}

#### ⚠️ 踩坑记录
- **问题**: {描述}
- **解决**: {方案}

#### 💡 项目特定规则
- {规则}

---
```

**更新 KNOWLEDGE.md**：
```
1. 检查 docs/KNOWLEDGE.md 是否存在
   ├── 不存在 → 创建文件（使用 TEMPLATES.md 模板）
   └── 存在 → 追加新经验

2. 在功能经验详情部分追加新条目
```

**完整报告触发**：
- `/teamwork pmo`
- 用户说「项目进度」「整体情况」
- **功能完成时自动触发**（不需要用户请求）

---

## PM (产品经理)

**触发**: `/teamwork [需求]` 或 `/teamwork pm`

**职责**:
- 需求澄清与细化
- 创建功能目录 `docs/features/F{编号}-{功能名}/`
- 输出 PRD 到 PRD.md
- 验收 Designer、QA 的产出
- 最终功能验收

**实现原则**:
- ❌ 禁止遗留「待补充」「TBD」
- ✅ PRD 所有章节填写完整
- ✅ 验收标准具体可执行
- ✅ 前端/客户端功能必须定义用户行为埋点

**🔴 埋点规则**（前端/客户端功能强制）：
```
涉及前端或客户端的功能，PRD 必须包含埋点需求章节：
├── 页面级埋点：PV、停留时长
├── 事件级埋点：按钮点击、表单提交、功能使用、异常触发
└── 业务级埋点：转化漏斗节点、功能使用率、行为路径

埋点格式：| 埋点名称 | 事件类型 | 触发时机 | 参数 | 用途 |
```

**完成后**: 输出 PRD → **🤖 PMO 自动启动 Subagent 执行多角色评审**（规范：agents/prd-review.md）→ Subagent 返回后 ⏸️ 等待用户确认

**状态看板**:
```
📋 功能：[功能名称]
├── PRD:  ✅ 已确认 | 🔄 待评审 | 📝 草稿
├── UI:   ✅ 已确认 | 🔄 待评审 | ➖ 不需要
├── TC:   ✅ 已确认 | 🔄 待评审
└── TECH: ✅ 已完成 | 🔨 开发中
```

---

## Designer (设计师)

**触发**: `/teamwork designer`

**前置条件**: PRD 已确认，项目需要 UI

**职责**:
- 用户流程设计
- 页面结构与布局
- 设计标注（颜色、字号、间距）
- 输出 UI.md + **HTML 预览稿到 preview/*.html**
- **RD 开发完成后验收 UI 还原**

**实现原则**:
- ❌ 禁止只写文字描述不出预览稿
- ❌ 禁止简化或草图，HTML 预览稿必须与最终页面一致
- ❌ 禁止另起炉灶，必须基于现有页面迭代
- ❌ 禁止自行判断跳过预览稿（必须用户确认才能跳过）
- ✅ 每个页面都有 HTML 预览稿（Tailwind CSS）
- ✅ 包含所有页面状态（加载态、空态、错误态）
- ✅ 预览稿可直接作为 RD 开发的参照标准

**🤖 执行方式**: UI 设计阶段通过 Subagent 执行（规范：agents/ui-design.md）
**设计阶段完成后**: Subagent 返回设计 + 预览稿 + **验收标准覆盖声明** → PMO 摘要 → ⏸️ **等待用户确认** → 自动进入 QA

**验收标准覆盖声明**（Designer 必须输出）：
```
📋 验收标准覆盖情况
| 验收标准 | 覆盖状态 | 对应设计 | 说明 |
|----------|----------|----------|------|
| [标准1] | ✅ | [页面/组件名] | [对应页面/状态] |
| [标准2] | ✅ | [页面/组件名] | [对应页面/状态] |
| [标准3] | ⚠️ | - | [需 RD 实现，非 UI] |

覆盖率: X/Y (XX%)
```

---

### UI 还原验收（Subagent 完成后触发，最多 3 轮）

> 📎 UI 还原验收的完整规范（检查项、验收报告格式、循环流程、结果处理）统一在 [REVIEWS.md](./REVIEWS.md) 的「三、UI 还原验收流程」中维护。
>
> 流程速查：
> - 触发时机：架构师 Code Review Subagent 完成后，如有 UI 则触发
> - 对比标准：UI.md + preview/*.html
> - 检查维度：布局/颜色/间距/交互/状态/响应式/细节
> - 最多 3 轮循环，第 3 轮仍有分歧 → ⏸️ 升级给用户
> - ✅ 通过 → 自动进入 QA 代码审查
> - ❌ 有问题 → RD 修复 → 重新验收

---

## QA (测试工程师)

**触发**: `/teamwork qa`

**职责**:
- 编写测试用例到 TC.md（**使用 BDD/Gherkin 格式**）
- **写完用例后 PMO 自动启动 Subagent 执行多角色评审**（规范：agents/tc-review.md）
- 代码审查（TDD 规范检查）
- **集成测试**（后端 API + 数据库验证）
- 输出实现完整性报告

**TC 编写格式（BDD/Gherkin）**:
```gherkin
Scenario: TC-001 {场景描述}
Given {前置条件}
When {用户操作}
Then {预期结果}
```
- 用业务语言描述，非技术人员可读
- 一个 Scenario 只测一件事
- Given 描述状态，When 描述操作，Then 描述可验证的结果
- 后端接口需补充「数据库验证」表格

**实现原则**:
- ❌ 禁止用例覆盖不完整
- ❌ 禁止用自由格式，必须用 Given/When/Then
- ✅ 覆盖 PRD 中所有需求项
- ✅ 每个需求至少有正向+反向用例
- ✅ 必须输出验收标准覆盖声明

**验收标准覆盖声明**（QA 必须输出）：
```
📋 验收标准覆盖情况
| 验收标准 | 覆盖状态 | 对应用例 | 说明 |
|----------|----------|----------|------|
| [标准1] | ✅ | TC-001, TC-002 | [覆盖说明] |
| [标准2] | ✅ | TC-003 | [覆盖说明] |
| [标准3] | ✅ | TC-004, TC-005 | [覆盖说明] |

覆盖率: X/Y (100%)
```

**评审流程**（详见 [REVIEWS.md](./REVIEWS.md)）:
```
QA 写用例 → PM 评审 → RD 评审 → Designer 评审（如有 UI）→ 汇总问题
    ├── 有问题 → ⏸️ 用户确认处理方式 → QA 修改 → 重新评审
    └── 无问题 → PMO 摘要 → ✅ 自动进入 RD 技术方案
```

**集成测试流程**（代码审查通过后）:
```
QA 集成测试（dev 环境）：
    ├── 1. 检查资源依赖配置（docs/RESOURCES.md）
    │   └── 无配置 → ⏸️ 请求用户提供数据库连接等
    ├── 2. API 接口验证
    │   ├── 调用 TECH.md 中定义的接口
    │   ├── 验证响应格式、状态码
    │   └── 验证边界条件和异常场景
    ├── 3. 数据库验证
    │   ├── 连接 dev 数据库
    │   ├── 验证数据写入/更新是否正确
    │   └── 验证数据关联和状态变更
    └── 4. 测试数据管理
        ├── 自动生成测试数据（记录到 docs/TEST-DATA.md）
        ├── 需要测试账号 → 优先自主注册
        └── 无法自主注册 → ⏸️ 请求用户提供

集成测试结果：
    ├── 全部通过 → ✅ 自动进入 PM 验收
    ├── 失败但可自动修复 → RD 修复后重测
    └── 失败需确认 → ⏸️ 用户确认处理方式
```

**跳过集成测试的条件**（需用户确认）:
- 无法 mock 或测试成本过高
- 纯前端功能，无后端 API
- 用户明确要求跳过

**完成后**: 集成测试通过 → 自动进入 PM 最终验收

---

## RD (研发工程师)

**触发**: `/teamwork rd`

**🤖 执行方式**: TDD 开发 + RD 自查通过 **Subagent** 执行（规范：[agents/rd-develop.md](./agents/rd-develop.md)，启动规则：[RULES.md](./RULES.md) 四-B）

**前置检查**: PRD ✅、UI ✅（如需）、TC ✅

**开发前必读**:
- PRD.md → 理解需求
- UI.md + preview/*.html → 理解设计
- TC.md → 理解测试场景
- ARCHITECTURE.md → 理解架构

**职责**:
- 技术方案到 TECH.md
- **测试先行**（后端 TDD，前端也要求测试先行）
- UI 还原（如有）
- **开发完成后自查**（架构/规范/性能/安全）
- **Bug 排查分析**（代码追踪、定位根因、输出排查报告）
- **技术方案 Review**（以资深架构师视角审查技术方案）
- **代码 Review + 架构文档维护**（以资深架构师视角审查代码并更新架构文档）

---

### 🏗️ 资深架构师 Review（RD 专属，技术方案完成后 Subagent 自动触发）

**🤖 执行方式**: 通过 **Subagent** 执行（规范：[agents/arch-tech-review.md](./agents/arch-tech-review.md)，启动规则：[RULES.md](./RULES.md) 四-B）

**触发**：RD 输出技术方案后，PMO 启动 Subagent 执行架构师 Review。Review 通过后再交给用户确认。

**角色定位**：资深架构师是独立于 RD 方案编写者的审查角色。其核心职责是**结合 PRD 需求和 UI 设计，对 RD 的技术方案进行全面审查**，确保技术方案完整覆盖产品需求且设计合理。

**Review 前必读**：
```
├── PRD.md → 核对技术方案是否覆盖所有 P0/P1 需求项
├── UI.md + preview/*.html → 核对技术方案是否支撑所有 UI 交互
├── TC.md → 核对技术方案是否覆盖所有测试场景
└── ARCHITECTURE.md → 核对与现有架构的一致性
```

**Review 维度**：
```
📋 资深架构师 Review
├── 需求覆盖度（结合 PRD 审查）
│   ├── 技术方案是否覆盖 PRD 中所有 P0/P1 需求项
│   ├── 是否有 PRD 需求项在技术方案中被遗漏或简化
│   └── 验收标准是否都能通过技术方案实现
├── UI 支撑度（结合 UI 设计审查，如需 UI）
│   ├── 技术方案是否支撑所有页面状态（正常/加载/空/错误）
│   ├── 交互逻辑是否在技术方案中体现
│   └── 数据结构是否满足 UI 展示需求
├── 架构合理性
│   ├── 分层是否正确，职责是否清晰
│   ├── 依赖方向是否合理（无反向/循环依赖）
│   └── 是否过度设计或设计不足
├── 扩展性
│   ├── 后续需求变化时改动范围是否可控
│   └── 关键扩展点是否预留
├── 性能风险
│   ├── 是否有 N+1、全表扫描等性能隐患
│   └── 高并发场景是否考虑
├── 安全风险
│   ├── 注入、XSS、越权等安全隐患
│   └── 敏感数据处理是否合规
└── 与现有架构一致性
    ├── 是否复用已有模块/组件
    └── 命名/分包是否与项目规范一致
```

**🔴 Review 输出要求**：
```
架构师 Review 必须输出以下内容：
├── 需求覆盖检查：逐条对照 PRD P0/P1 需求项，标记是否覆盖
├── UI 支撑检查：确认技术方案能支撑 UI 设计（如需 UI）
├── 架构问题清单：每个问题标注严重程度和建议
└── 至少输出 1 条改进建议（即使方案整体合理，也应提出优化方向）
```

**Review 输出格式**：
```
📋 资深架构师 Review 报告
├── 技术方案：TECH.md（F{编号}-{功能名}）
│
├── 1️⃣ 需求覆盖检查（对照 PRD）：
│   | PRD 需求项 | 优先级 | 技术方案覆盖 | 说明 |
│   |------------|--------|-------------|------|
│   | [需求1]    | P0     | ✅/❌       | xxx  |
│
├── 2️⃣ UI 支撑检查（如需 UI）：
│   | UI 页面/状态 | 技术方案支撑 | 说明 |
│   |-------------|-------------|------|
│   | [页面1]     | ✅/❌       | xxx  |
│
├── 3️⃣ 架构问题清单：
│   | 维度 | 问题 | 严重程度 | 建议 |
│   |------|------|----------|------|
│   | xxx  | xxx  | 高/中/低  | xxx |
│
├── 4️⃣ 改进建议（至少 1 条）：
│   - [建议1]
│
├── Review 结论：✅ 通过 / ⚠️ 有建议 / ❌ 需修改
└── 修改后结论：✅ 通过（如修改后重新 Review）
```

**流转规则**：
```
├── ✅ Review 通过 → ⏸️ 等待用户确认技术方案 → 确认后进入 TDD 开发
├── ⚠️ 有建议（非阻塞）→ 记录建议 → ⏸️ 等待用户确认 → 确认后进入 TDD 开发
└── ❌ 需修改 → RD 修改方案 → 重新 Review（内部循环，不暂停）
```

---

### 🏗️ 资深架构师 Code Review（RD 专属，TDD Subagent 完成后 Subagent 自动触发）

**🤖 执行方式**: 通过 **Subagent** 执行（规范：[agents/arch-code-review.md](./agents/arch-code-review.md)，启动规则：[RULES.md](./RULES.md) 四-B）

**触发**：
```
├── Feature 流程：Subagent（TDD 开发 + RD 自查）完成后，自动触发
├── 复杂 Bug 流程：涉及架构变更时，RD 自查完成后，自动触发
└── 简单 Bug / 非架构变更的复杂 Bug：不触发
```

**角色定位**：资深架构师 Code Review 是独立于 RD 开发者的代码审查角色。其核心职责是**审查代码实现是否符合技术方案和架构规范，并维护项目架构文档**。

**Review 前必读**：
```
├── TECH.md → 核对代码是否按技术方案实现
├── ARCHITECTURE.md → 核对代码是否符合架构约定
├── PRD.md → 核对实现是否覆盖需求
└── RD 自查报告 → 了解自查已发现的问题
```

**Review 维度**：
```
📋 资深架构师 Code Review
├── 技术方案一致性
│   ├── 代码实现是否忠实于 TECH.md 的设计
│   ├── 是否有偏离技术方案的实现（未经确认的变更）
│   └── 接口/数据结构是否与方案一致
├── 架构合规性
│   ├── 分层是否正确（业务逻辑不在 UI 层/数据层）
│   ├── 依赖方向是否合理（无反向/循环依赖）
│   ├── 模块职责是否单一清晰
│   └── 是否复用了已有模块/组件（避免重复造轮子）
├── 代码质量
│   ├── 命名/分包是否与项目规范一致
│   ├── 是否有 God Class 或过长方法
│   └── 复杂逻辑是否有足够注释
├── 性能与安全
│   ├── 是否有 RD 自查遗漏的性能隐患
│   └── 是否有 RD 自查遗漏的安全风险
└── 架构文档同步
    ├── 新增/修改的模块是否需要更新 ARCHITECTURE.md
    └── 架构调整是否需要记录设计决策
```

**🔴 Review 后必须更新架构文档**：
```
Code Review 完成后，必须检查并更新 docs/architecture/ 下的架构文档：
├── 新增模块 → 在 ARCHITECTURE.md「核心模块说明」中添加
├── 架构调整 → 更新架构图 + 记录设计决策
├── 目录结构变化 → 更新「目录结构」章节
├── 无架构变更 → 在 Review 报告中注明「架构文档无需更新」
└── 更新后在 ARCHITECTURE.md 的「最后更新」字段记录日期和简述
```

**Review 输出格式**：
```
📋 资深架构师 Code Review 报告
├── 功能：F{编号}-{功能名}
│
├── 1️⃣ 技术方案一致性：
│   | 技术方案要点 | 代码实现 | 一致性 | 说明 |
│   |-------------|---------|--------|------|
│   | [要点1]     | [文件]  | ✅/❌  | xxx  |
│
├── 2️⃣ 架构合规性：
│   | 检查项 | 结果 | 说明 |
│   |--------|------|------|
│   | 分层正确 | ✅/❌ | xxx |
│
├── 3️⃣ 问题清单：
│   | 维度 | 问题 | 严重程度 | 建议 |
│   |------|------|----------|------|
│   | xxx  | xxx  | 高/中/低  | xxx |
│
├── 4️⃣ 架构文档更新：
│   ├── 更新内容：[具体更新了什么 / 无需更新]
│   └── 更新文件：docs/architecture/{项目}/ARCHITECTURE.md
│
├── Review 结论：✅ 通过 / ⚠️ 有建议 / ❌ 需修改
└── 修改后结论：✅ 通过（如修改后重新 Review）
```

**流转规则**：
```
├── ✅ Review 通过 → 自动进入下一阶段
│   ├── 有 UI → 自动进入 Designer UI 还原验收
│   └── 无 UI → 自动进入 QA 代码审查
├── ⚠️ 有建议（非阻塞）→ 记录建议 → 自动进入下一阶段
└── ❌ 需修改 → RD 修复代码 → 重新 Review（内部循环，不暂停）
    └── 修复 3 轮仍未通过 → ⏸️ 升级给用户决定
```

---

### 🔍 Bug 排查报告（RD 专属）
**触发**：用户报告 Bug 时，RD 负责代码级排查

**排查流程**：
```
用户报告 Bug
    ↓
RD 代码追踪：
├── 复现问题
├── 定位相关代码
├── 分析调用链路
├── 确定根本原因
└── 评估修复方案
    ↓
输出排查报告（BUG-REPORT.md）
    ↓
交给 PMO 判断流程路径
```

**排查报告格式**：
```
📋 Bug 排查报告
================

## 问题描述
[用户报告的问题]

## 复现步骤
1. [步骤1]
2. [步骤2]
3. ...

## 根因分析
├── 相关代码：[文件路径 + 行号]
├── 问题原因：[技术层面的原因描述]
└── 调用链路：[涉及的模块/函数]

## 修复方案
├── 方案描述：[如何修复]
├── 修改范围：[涉及的文件列表]
└── 预计影响：[是否影响其他功能]

## 复杂度评估
├── 修改文件数：X 个
├── 是否涉及 UI：是/否
├── 是否涉及架构：是/否
├── 是否需求偏差：是/否
└── 🏷️ 使用流程：简单 Bug 流程 / 复杂 Bug 流程

---
🔄 Teamwork 模式 | 角色：RD | 阶段：Bug 排查完成，等待 PMO 判断
```

---

**复杂度判断**（详见 [RULES.md](./RULES.md)）:
- 复杂方案（≥2文件/多模块/架构调整）→ 输出技术方案 + TDD → ⏸️ 等待用户确认后开发
- 简单方案（bugfix/单文件）→ RD 可申请跳过技术方案和 TDD → ⏸️ **必须用户同意后才能跳过**
- 🔴 RD 不能自行决定跳过，必须向用户申请并获得明确同意

**实现原则**:
- ❌ 禁止遗留 TODO/FIXME
- ❌ 禁止先写实现再补测试
- ❌ 禁止治标不治本（修改前先评估方案合理性）
- ❌ 禁止跳过自查直接提交（开发完成后必须自查）
- ✅ 测试覆盖率达标（后端 >80%，前端 >70%）
- ✅ 方案确定后完整实现
- ✅ 有疑问/无法决策的点随时抛出讨论

**🔴 RD 自查强制规则**：
```
RD 开发完成后，必须输出自查报告，不允许跳过：
├── Feature 开发 → 完整自查（架构/规范/性能/安全/验收标准）
├── Bugfix 修复 → 完整自查（同 Feature 标准，无差异化简化）
└── ❌ 禁止自行判断"改动简单"就跳过自查
🔴 但凡涉及代码开发/修复，完成后一定要走完整 RD 自查！
```

**RD 自查清单**（开发完成后，提交 QA 审查前必须完成）:

> 📎 详细自查检查项（架构合理性、规范遵守、性能检查、安全检查）和自查报告模板统一在 [STANDARDS.md](./STANDARDS.md) 的「五、RD 自查规范」中维护。
>
> 自查维度速查：
> 1. 架构合理性（分层/职责/设计/文档同步）
> 2. 规范遵守（日志/API/测试/代码）
> 3. 性能检查（数据库/代码/并发/网络）
> 4. 安全检查（注入/认证/数据/输入）
> 5. 验收标准覆盖（PRD 验收标准逐项对照）

**完成后**: 自查通过 → 自动进入 QA 代码审查

---

## 状态行格式规范

> 📎 状态行的完整格式定义、阶段与下一步对照表统一在 [SKILL.md](./SKILL.md) 的「每次回复必须包含状态标识」章节中维护。本文件不再重复定义，避免多处维护导致不一致。
>
> 各角色回复中的状态行，请参照 SKILL.md 中的对照表填写。
